steps:
  - name: Checkout repository
    uses: actions/checkout@v4
    with:
      token: ${{ secrets.GITHUB_TOKEN }} 

  - name: Setup R Environment
    uses: r-lib/actions/setup-r@v2
    with:
      r-version: 4.5.1

  - name: Install System Dependencies for R packages
    uses: r-lib/actions/setup-r-dependencies@v2
    with:
      packages: |
        nflseedR
        nflreadr
        dplyr
        jsonlite
        knitr

  - name: Run NFL Simulation Script
    run: |
      if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
        SEASON="${{ github.event.inputs.season }}"
        SIMS="${{ github.event.inputs.simulations }}"
        CHUNKS="${{ github.event.inputs.chunks }}"
        RATINGS_FILE="${{ github.event.inputs.ratings_file }}"
      else
        SEASON="2025"
        SIMS="1000"
        CHUNKS="10"
        RATINGS_FILE="teams_rating.csv"
      fi

      echo "Running R Script with: $SEASON, $SIMS, $CHUNKS, $RATINGS_FILE"
      Rscript runSim.R $SEASON $SIMS $CHUNKS $RATINGS_FILE

  - name: Commit and Push output.json
    run: |
      # Configure Git credentials
      git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
      git config --local user.name "github-actions[bot]"
      
      git add output.json
      
      git commit -m "ðŸ¤– [Automated] Update simulation results!" || echo "No changes to commit"
      
      git push